<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Haxla RPG</title>

<style>
body{margin:0;background:#000;color:#fff;font-family:-apple-system}
#game{max-width:420px;margin:auto}
.top{display:flex;align-items:center;padding:6px;background:#0b2a44}
.circle{width:64px;height:64px;border-radius:50%;background:linear-gradient(#1e4f7a,#0b2a44);
display:flex;align-items:center;justify-content:center;font-size:12px}
.bar{flex:1;height:30px;margin:0 6px;background:#143b63;border-radius:4px}
.menu{display:flex;background:#061a2a}
.menu button{flex:1;border:none;background:#061a2a;color:#9cf;padding:8px}
.menu button.active{background:#0e2a42}
.screen{display:none}
.screen.active{display:block}
.dungeon{height:240px;background:radial-gradient(#222,#000);
display:flex;flex-direction:column;align-items:center;justify-content:center}
.enemy{margin:6px;font-size:14px}
.enemy-img{width:64px;height:64px;border-radius:50%;margin-bottom:4px}
.party{display:grid;grid-template-columns:repeat(5,1fr);gap:2px;padding:4px;background:#061a2a}
.chara{background:#0e2a42;padding:4px;font-size:9px;text-align:center}
.face{width:36px;height:36px;border-radius:50%;background:linear-gradient(#666,#222);margin:auto}
.hp-bar{height:6px;background:#333;border-radius:3px;overflow:hidden}
.hp-bar span{display:block;height:100%;background:linear-gradient(#4eff9a,#1fae63)}
.panel{padding:10px;text-align:center}
.panel button{margin:4px;padding:8px;border:none;background:#0e2a42;color:#fff}
.stat{font-size:12px;margin:2px}
</style>
</head>

<body>
<div id="game">

<div class="top">
  <div class="circle">
    <div>
      <div id="floor">1F</div>
      <div id="dist">0m</div>
    </div>
  </div>
  <div class="bar"></div>
</div>

<div class="menu">
  <button id="btn-dungeon" class="active" onclick="show('dungeon')">ダンジョン</button>
  <button id="btn-town" onclick="show('town')">拠点</button>
  <button id="btn-status" onclick="show('status')">ステータス</button>
</div>

<div id="dungeon" class="screen active">
  <div class="dungeon">
    <div id="enemyImg" class="enemy-img"></div>
    <div class="enemy" id="enemyName"></div>
    <div class="enemy" id="enemyHp"></div>
  </div>
  <div class="party" id="party"></div>
</div>

<div id="town" class="screen">
  <div class="panel">
    <button onclick="heal()">全回復</button><br>
    <button onclick="moveFloor(1)">次の階層</button>
    <button onclick="moveFloor(-1)">前の階層</button>
  </div>
</div>

<div id="status" class="screen">
  <div id="statusList"></div>
</div>

</div>

<script>
const ENEMIES=[
{name:"スライム",hp:120,atk:5,color:"#3af"},
{name:"ゴブリン",hp:180,atk:8,color:"#6f6"},
{name:"スケルトン",hp:240,atk:10,color:"#ccc"}
];
const BOSSES=[
{name:"階層の守護者",hp:800,atk:15,color:"#f55"}
];

const PARTY=[
{name:"クローディア",lv:1,exp:0,hp:2984,max:2984,atk:30,def:10},
{name:"アヤメ",lv:1,exp:0,hp:2117,max:2117,atk:35,def:6},
{name:"ベアトリクス",lv:1,exp:0,hp:2631,max:2631,atk:20,def:8},
{name:"ドゥーガルド",lv:1,exp:0,hp:2362,max:2362,atk:18,def:14},
{name:"カルロス",lv:1,exp:0,hp:2323,max:2323,atk:28,def:9}
];

let state=JSON.parse(localStorage.getItem("save"))||{
floor:1,dist:0,enemy:null,party:PARTY
};

function save(){localStorage.setItem("save",JSON.stringify(state));}

function show(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.querySelectorAll(".menu button").forEach(b=>b.classList.remove("active"));
document.getElementById("btn-"+id).classList.add("active");
render();
}

function spawnEnemy(){
const isBoss=state.dist>0 && state.dist%10===0;
const src=isBoss?BOSSES:ENEMIES;
const e=JSON.parse(JSON.stringify(src[Math.floor(Math.random()*src.length)]));
e.maxHp=e.hp;
state.enemy=e;
}

function render(){
document.getElementById("floor").textContent=state.floor+"F";
document.getElementById("dist").textContent=state.dist+"m";

if(!state.enemy)spawnEnemy();
document.getElementById("enemyName").textContent=state.enemy.name;
document.getElementById("enemyHp").textContent="HP "+Math.floor(state.enemy.hp)+"/"+state.enemy.maxHp;
const img=document.getElementById("enemyImg");
img.style.background=state.enemy.color;

const p=document.getElementById("party");
p.innerHTML="";
state.party.forEach(c=>{
p.innerHTML+=`
<div class="chara">
<div class="face"></div>
${c.name} Lv${c.lv}
<div class="hp-bar"><span style="width:${c.hp/c.max*100}%"></span></div>
</div>`;
});

const s=document.getElementById("statusList");
s.innerHTML="";
state.party.forEach(c=>{
s.innerHTML+=`
<div class="panel">
<b>${c.name}</b>
<div class="stat">Lv ${c.lv} EXP ${c.exp}/${c.lv*100}</div>
<div class="stat">HP ${c.hp}/${c.max}</div>
<div class="stat">攻 ${c.atk} 防 ${c.def}</div>
</div>`;
});

save();
}

function heal(){state.party.forEach(c=>c.hp=c.max);render();}

function moveFloor(d){
state.floor=Math.max(1,state.floor+d);
state.dist=0;
spawnEnemy();
render();
}

function levelCheck(c){
const need=c.lv*100;
if(c.exp>=need){
c.exp-=need;
c.lv++;
c.max=Math.floor(c.max*1.1);
c.hp=c.max;
c.atk+=5;
c.def+=3;
}
}

function tick(){
if(!state.enemy)return;

let dmg=0;
state.party.forEach(c=>dmg+=c.atk);
state.enemy.hp-=dmg;

if(state.enemy.hp<=0){
state.dist++;
state.party.forEach(c=>{
c.exp+=20;
levelCheck(c);
});
spawnEnemy();
}

render();
}

render();
setInterval(tick,1000);
</script>
</body>
</html>
