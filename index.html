<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Haxla RPG</title>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: sans-serif;
}
#game {
  max-width: 420px;
  margin: auto;
}

/* ä¸Šéƒ¨UI */
.top {
  display: flex;
  align-items: center;
  padding: 6px;
  background: #0b2a44;
}
.circle {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: #143b63;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}
.bar {
  flex: 1;
  height: 32px;
  margin: 0 6px;
  background: #123b5c;
}
.icons {
  font-size: 14px;
}

/* ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ */
.dungeon {
  height: 260px;
  background: radial-gradient(#222, #000);
  display: flex;
  align-items: center;
  justify-content: center;
}
.enemy {
  color: #f55;
  font-size: 18px;
}

/* ãƒ‘ãƒ¼ãƒ†ã‚£UI */
.party {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 2px;
  padding: 4px;
  background: #061a2a;
}
.chara {
  background: #0e2a42;
  padding: 4px;
  font-size: 10px;
  text-align: center;
}
.face {
  height: 40px;
  background: #222;
  margin-bottom: 2px;
}
.hp-bar {
  height: 6px;
  background: #333;
}
.hp-bar span {
  display: block;
  height: 100%;
  background: #2ecc71;
}
.skill {
  font-size: 9px;
  color: #9cf;
}
</style>
</head>

<body>
<div id="game">

  <div class="top">
    <div class="circle"><span id="dist">0m</span></div>
    <div class="bar"></div>
    <div class="icons">â–¶â–¶ ðŸ”Š è‡ªå‹•</div>
  </div>

  <div class="dungeon">
    <div class="enemy" id="enemy">æŽ¢ç´¢ä¸­â€¦</div>
  </div>

  <div class="party" id="party"></div>

</div>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let state = JSON.parse(localStorage.getItem("save")) || {
  dist: 0,
  enemyHp: 200,
  party: [
    {name:"ã‚¯ãƒ­ãƒ¼ãƒ‡ã‚£ã‚¢", hp:2984, max:2984, skill:"å…ˆé™£"},
    {name:"ã‚¢ãƒ¤ãƒ¡", hp:2117, max:2117, skill:"å½±æ–¬ã‚Š"},
    {name:"ãƒ™ã‚¢ãƒˆãƒªã‚¯ã‚¹", hp:2631, max:2631, skill:"ç¥ˆã‚Š"},
    {name:"ãƒ‰ã‚¥ãƒ¼ã‚¬ãƒ«ãƒ‰", hp:2362, max:2362, skill:"é‰„å£"},
    {name:"ã‚«ãƒ«ãƒ­ã‚¹", hp:2323, max:2323, skill:"æ¿€æ˜‚"}
  ]
};

const enemy = document.getElementById("enemy");
const partyDiv = document.getElementById("party");

/* ===== æç”» ===== */
function render() {
  document.getElementById("dist").textContent = state.dist + "m";
  partyDiv.innerHTML = "";

  state.party.forEach(c => {
    const el = document.createElement("div");
    el.className = "chara";
    el.innerHTML = `
      <div class="face"></div>
      ${c.name}
      <div class="hp-bar">
        <span style="width:${(c.hp/c.max)*100}%"></span>
      </div>
      <div class="skill">${c.skill}</div>
    `;
    partyDiv.appendChild(el);
  });

  localStorage.setItem("save", JSON.stringify(state));
}

/* ===== æˆ¦é—˜ï¼‹ã‚¹ã‚­ãƒ« ===== */
function tick() {
  state.dist++;

  let dmg = 40;

  // ã‚¹ã‚­ãƒ«å‡¦ç†
  state.party.forEach(c => {
    if (c.skill === "å…ˆé™£") dmg *= 1.2;
    if (c.skill === "å½±æ–¬ã‚Š" && Math.random() < 0.2) dmg *= 2;
    if (c.skill === "ç¥ˆã‚Š") c.hp = Math.min(c.max, c.hp + 10);
    if (c.skill === "æ¿€æ˜‚") dmg *= (1 + (1 - c.hp / c.max));
  });

  state.enemyHp -= dmg;

  if (state.enemyHp <= 0) {
    state.enemyHp = 200 + state.dist * 2;
  }

  enemy.textContent = "æ•µ HP " + Math.floor(state.enemyHp);

  // è¢«ãƒ€ãƒ¡
  const t = state.party[Math.floor(Math.random()*state.party.length)];
  let taken = 25;
  if (t.skill === "é‰„å£") taken *= 0.7;
  t.hp -= taken;

  // å…¨æ»…å¾©æ´»
  if (state.party.every(c => c.hp <= 0)) {
    state.party.forEach(c => c.hp = c.max);
  }

  render();
}

render();
setInterval(tick, 1000);
</script>

</body>
</html>